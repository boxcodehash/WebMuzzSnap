<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>MuzzSnap - Terminal Edition</title>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Inter:wght@400;700&family=Orbitron:wght@400;900&display=swap');
    
    :root { --muzz-red: #ff0000; --ryachu-gold: #ffcc00; --itsuki-blue: #00d4ff; }

    /* TEMAS */
    body.dark-theme { background: #050505; color: white; }
    body.light-theme { background: #f5f5f5; color: #1a1a1a; }

    .panel-3d { border-radius: 24px; transition: all 0.3s ease; }
    .dark-theme .panel-3d { background: #0c0c0c; border: 1px solid rgba(255,0,0,0.15); box-shadow: 0 10px 30px rgba(0,0,0,0.8); }
    .light-theme .panel-3d { background: #ffffff; border: 1px solid #ddd; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }

    .bubble-3d { padding: 10px 16px; border-radius: 18px; font-size: 13px; max-width: 80%; }
    .bubble-3d.me { background: linear-gradient(145deg, #ff0000, #b30000); color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
    
    .dark-theme .bubble-3d.other { background: #1a1a1a; border: 1px solid rgba(255,255,255,0.05); }
    .light-theme .bubble-3d.other { background: #e8e8e8; color: black; border: 1px solid #ccc; }

    .hacker-input { font-family: 'Fira Code', monospace; }
    .dark-theme .hacker-input { color: #39ff14 !important; }
    .light-theme .hacker-input { color: #000 !important; }

    /* Selector de Emojis */
    .emoji-tab-content { display: grid; grid-template-columns: repeat(8, 1fr); gap: 8px; max-height: 120px; overflow-y: auto; padding: 10px; }
    .emoji-item { font-size: 1.4rem; transition: transform 0.2s; cursor: pointer; }
    .emoji-item:hover { transform: scale(1.3); }
    
    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-thumb { background: var(--muzz-red); border-radius: 10px; }
  </style>
</head>
<body class="dark-theme">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    
    const firebaseConfig = {
      apiKey: "AIzaSyAe1-JfNde0NKIMdE7phfEXlm9JaqUH0jY",
      authDomain: "pulsari.firebaseapp.com",
      databaseURL: "https://pulsari-default-rtdb.firebaseio.com",
      projectId: "pulsari",
      storageBucket: "pulsari.firebasestorage.app",
      messagingSenderId: "824306321233",
      appId: "1:824306321233:web:2c9bfa02170a17d560b570"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    const EMOJI_LIST = {
      "Faces": ["ðŸ˜Š", "ðŸ˜‚", "ðŸ˜‰", "ðŸ˜", "ðŸ˜˜", "ðŸ˜›", "ðŸ˜…", "ðŸ˜¢", "ðŸ˜­", "ðŸ˜ ", "ðŸ˜ˆ", "ðŸ‘½", "ðŸ¤–", "ðŸ¤¡", "ðŸ’€", "ðŸ‘»", "ðŸ’©"],
      "Hands": ["ðŸ‘", "ðŸ‘Ž", "ðŸ‘Œ", "âœŒï¸", "ðŸ‘", "ðŸ‘‹", "ðŸ™", "ðŸ’ª", "â˜ï¸", "ðŸ––"],
      "Objects": ["â¤ï¸", "â­", "ðŸ”¥", "ðŸ“š", "ðŸ’»", "ðŸ“±", "ðŸ“·", "ðŸ”‘", "ðŸ”’", "ðŸ’¡", "ðŸ’°", "ðŸ’Ž"],
      "Nature": ["â˜€ï¸", "â˜ï¸", "ðŸŒˆ", "ðŸŒ³", "ðŸŒ¸", "ðŸŒµ", "ðŸ±", "ðŸ¶", "ðŸ¦", "ðŸ¦„", "ðŸ‰", "ðŸ"],
      "Food": ["ðŸ•", "ðŸ”", "ðŸŒ®", "ðŸ£", "ðŸ°", "ðŸ¦", "â˜•", "ðŸº", "ðŸ·", "ðŸ¸"],
      "Activity": ["âš½", "ðŸ€", "ðŸŽ¾", "ðŸŽµ", "ðŸŽ¸", "ðŸŽ®", "â™Ÿï¸", "ðŸŽ¨", "ðŸŽ¬"]
    };

    function App() {
      const [user, setUser] = useState(null);
      const [messages, setMessages] = useState([]);
      const [inputText, setInputText] = useState("");
      const [isDark, setIsDark] = useState(true);
      const [showEmoji, setShowEmoji] = useState(false);
      const [activeEmojiTab, setActiveEmojiTab] = useState("Faces");
      const [isMobileMenu, setIsMobileMenu] = useState(false);
      const dummyRef = useRef(null);

      const toggleTheme = () => {
        setIsDark(!isDark);
        document.body.classList.toggle('light-theme');
        document.body.classList.toggle('dark-theme');
      };

      useEffect(() => {
        const sessionData = sessionStorage.getItem('muzz_wallet_address');
        if (!sessionData) { window.location.href = 'login.html'; return; }
        const isWallet = !sessionData.startsWith('guest_');
        const name = isWallet ? `Node_${sessionData.slice(-4)}` : sessionData.replace('guest_', '');
        setUser({ username: name, role: isWallet ? 'user' : 'guest' });

        database.ref('messages/general').limitToLast(40).on('value', snap => {
          const data = snap.val();
          setMessages(data ? Object.keys(data).map(k => ({id:k, ...data[k]})) : []);
        });
      }, []);

      useEffect(() => { dummyRef.current?.scrollIntoView({ behavior: 'smooth' }); }, [messages]);

      const handleSend = () => {
        if (!inputText.trim()) return;
        database.ref('messages/general').push({
          content: inputText, username: user.username, role: user.role, timestamp: Date.now()
        });
        setInputText("");
        setShowEmoji(false);
      };

      if (!user) return null;

      return (
        <div className="flex h-screen p-2 md:p-4 lg:p-6 gap-4 max-w-[1600px] mx-auto overflow-hidden">
          
          {/* SIDEBAR */}
          <aside className={`fixed lg:relative z-50 inset-y-0 left-0 w-64 panel-3d p-6 flex flex-col transition-all ${isMobileMenu ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'}`}>
            <h1 className="font-orbitron font-black text-red-600 mb-8 italic text-xl">MUZZSNAP</h1>
            <div className="flex-1">
              <p className="text-[10px] text-gray-500 font-bold tracking-widest mb-4 uppercase">Channels</p>
              <button className="w-full text-left px-4 py-3 rounded-xl bg-red-600/10 text-red-600 font-bold text-xs"># GENERAL</button>
            </div>
            <button onClick={() => window.location.href='login.html'} className="mt-4 py-2 border border-red-900/20 text-red-900 text-[10px] uppercase font-bold rounded-lg hover:bg-red-900/10">Disconnect</button>
          </aside>

          {/* CHAT MAIN */}
          <main className="flex-1 panel-3d flex flex-col overflow-hidden relative">
            <header className="h-16 flex items-center justify-between px-6 border-b border-white/5 bg-white/5">
              <div className="flex items-center gap-4">
                <button onClick={() => setIsMobileMenu(true)} className="lg:hidden text-red-600"><i className="fas fa-bars"></i></button>
                <span className="text-sm font-black text-red-600 italic tracking-widest uppercase">/ Protocol</span>
              </div>
              <button onClick={toggleTheme} className="w-10 h-10 rounded-xl border border-red-600/20 flex items-center justify-center transition-all hover:bg-red-600/5">
                {isDark ? <i className="fas fa-sun text-yellow-500"></i> : <i className="fas fa-moon text-blue-500"></i>}
              </button>
            </header>

            <div className="flex-1 overflow-y-auto p-4 md:p-6 flex flex-col gap-4">
              {messages.map(msg => (
                <div key={msg.id} className={`flex flex-col ${msg.username === user.username ? 'items-end' : 'items-start'}`}>
                  <span className="text-[10px] text-gray-500 mb-1 font-bold uppercase tracking-tighter">{msg.username}</span>
                  <div className={`bubble-3d shadow-xl ${msg.username === user.username ? 'me' : 'other'}`}>
                    {msg.content}
                  </div>
                </div>
              ))}
              <div ref={dummyRef}></div>
            </div>

            {/* CONTROLES DE INPUT Y EMOJIS */}
            <div className={`p-4 ${isDark ? 'bg-black/40' : 'bg-gray-100'} border-t border-white/5`}>
              
              {showEmoji && (
                <div className={`mb-4 panel-3d !rounded-2xl overflow-hidden border border-red-600/20`}>
                  <div className="flex bg-black/20 border-b border-white/5 overflow-x-auto">
                    {Object.keys(EMOJI_LIST).map(tab => (
                      <button key={tab} onClick={() => setActiveEmojiTab(tab)} 
                        className={`px-4 py-2 text-[10px] font-bold uppercase ${activeEmojiTab === tab ? 'text-red-600 bg-red-600/5' : 'text-gray-500'}`}>
                        {tab}
                      </button>
                    ))}
                  </div>
                  <div className="emoji-tab-content">
                    {EMOJI_LIST[activeEmojiTab].map(e => (
                      <span key={e} onClick={() => setInputText(inputText + e)} className="emoji-item flex justify-center">{e}</span>
                    ))}
                  </div>
                </div>
              )}

              <div className="flex items-center bg-black/20 border border-white/10 rounded-2xl p-2 pl-4 focus-within:border-red-600/50 transition-all">
                <button onClick={() => setShowEmoji(!showEmoji)} className="text-gray-500 hover:text-red-500 px-2 transition-colors">
                  <i className="far fa-laugh-beam text-lg"></i>
                </button>
                <input value={inputText} onChange={e => setInputText(e.target.value)} onKeyDown={e => e.key === 'Enter' && handleSend()} 
                  placeholder="Transmit encrypted data..." className="flex-1 bg-transparent border-none focus:ring-0 text-sm hacker-input mx-2" />
                <button onClick={handleSend} className="w-12 h-12 bg-red-600 rounded-xl flex items-center justify-center hover:bg-red-500 shadow-lg active:scale-95 transition-all">
                  <i className="fas fa-paper-plane text-white"></i>
                </button>
              </div>
            </div>
          </main>
          
          {isMobileMenu && <div onClick={() => setIsMobileMenu(false)} className="fixed inset-0 bg-black/80 z-40 lg:hidden backdrop-blur-sm"></div>}
        </div>
      );
    }
    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
